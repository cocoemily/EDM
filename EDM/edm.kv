#:kivy 1.1.0
#:set BUTTON_BACKGROUND (0, .69, 255/255, 1)
#:set BUTTON_COLOR (0, 0, 0, 1)
#:set MENU_COLOR [0, 0, 0]
#:set WINDOW_COLOR (0, 0, 0, 1)
#:set SUBMENU_COLOR (1, 1, 1, 1)

<MainScreen>:
    BoxLayout:
        id: mainbox
        orientation: 'vertical'
        BoxLayout:
            ActionView:
                size_hint_y : .1
                use_separator: True
                pos_hint: {'top': 1}
                background_image: 'white-bg.png'
                background_color: (.5, .5, .5, 1)
                background_normal: ''
                ActionPrevious:
                    title: 'EDM'
                    with_previous: False
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                ActionOverflow:
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                ActionGroup:
                    text: 'Help'
                    color: root.text_color
                    id: topmenu
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'Status'
                        on_press: app.root.current = 'StatusScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Log'
                        on_press: app.root.current = 'LogScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'CFG'
                        on_press: app.root.current = 'CFGScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'INI'
                        on_press: app.root.current = 'INIScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'About'
                        on_press: app.root.current = 'AboutScreen'
                        color: SUBMENU_COLOR
                ActionGroup:
                    text: 'Edit'
                    color: root.text_color
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'The last point'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Points'
                        on_press: app.root.current = 'EditPointsScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Datums'
                        on_press: app.root.current = 'EditDatumsScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Units'
                        on_press: app.root.current = 'EditUnitsScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Prims'
                        on_press: app.root.current = 'EditPrismsScreen'
                        color: SUBMENU_COLOR
                ActionGroup:
                    text: 'Setup'
                    color: root.text_color
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'Configure Station'
                        on_press: app.root.current = 'StationConfigurationScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Direct'
                        on_press: app.root.current = 'InitializeDirectScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Set Angle Only'
                        on_press: app.root.current = 'InitializeSetAngleScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Shoot One Point'
                        on_press: app.root.current = 'InitializeOnePointScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Over One Point +\nShoot One Point'
                        on_press: app.root.current = 'InitializeTwoPointScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Shoot Two Points'
                        on_press: app.root.current = 'InitializeThreePointScreen'
                        color: SUBMENU_COLOR
                ActionGroup:
                    text: 'File'
                    color: root.text_color
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'Open CFG'
                        on_release: root.show_load_cfg()
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Export data as CSVs'
                        on_release: root.show_save_csvs()
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Exit'
                        on_release: app.stop()
                        color: SUBMENU_COLOR

<StatusScreen>:

<LogScreen>:

<AboutScreen>:

<StationConfigureScreen>:
    name: 'stationconfigure'

<InitializeDirectScreen>:
    name: 'datums'
    popup: None
    BoxLayout:
        orientation: 'vertical'
        spacing: 5
        Label:
            text: 'Use this option to set the station coordinates only.\n  This option assumes that the horizontal angle is already correct.'
            size_hint_y: .8
            valign: 'middle'
            halign: 'center'
            font_size: 20
            color: WINDOW_COLOR
        BoxLayout:
            orientation: 'horizontal'
            spacing: 5
            size_hint_y: .2
            Button:
                text: 'Next'
                on_press: root.datum_list()
                default_size: None, dp(56)
                default_size_hint: 1, None
                color: BUTTON_COLOR
                background_color: BUTTON_BACKGROUND
                background_normal: ''
            Button:
                text: 'Back'
                on_press: app.root.current = 'MainScreen'
                default_size: None, dp(56)
                default_size_hint: 1, None
                color: BUTTON_COLOR
                background_color: BUTTON_BACKGROUND
                background_normal: ''

<datumlist>:
    RecycleBoxLayout:
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<SelectableButton>:
    # Draw a background to indicate selection
    canvas.before:
        Color:
            rgba: (0.0, 0.9, 0.1, 0.3)
        Rectangle:
            pos: self.pos
            size: self.size

<DatumLister>:
    BoxLayout:
        orientation: "vertical"
        size_hint_y: None
        height: 30
        Label:
            text: 'Select a datum or define a new one.'
        Button:
            text: "New"
        Button:
            text: "Cancel"


<InitializeSetAngleScreen>:
    BoxLayout:
        size_hint_y: None
        orientation: "vertical"
        Label:
            text: 'Set an angle. Either enter the angle to the point or from the point.'
        BoxLayout:
            orientation: "horizontal"
            Label:
                text: 'Anlge to the point :'
            TextInput:
                id: foreshot
        BoxLayout:
            orientation: "horizontal"
            Label:
                text: 'or angle from the point :'
            TextInput:
                id: backshot
        BoxLayout:
            orientation: "horizontal"
            Button:
                text: "Set Angle"
                on_press: root.set_angle(foreshot.text, backshot.text)
            Button:
                text: "Cancel"
                on_press: app.root.current = 'MainScreen'


<InitializeOnePointScreen>:
    BoxLayout:
        size_hint_y: None
        orientation: "vertical"


<InitializeOnePointHeader>:
    Label:
        text: 'Initialize the station by recording one known point.  This method assumes that the horizontal angle is already correct. Select the datum to record.'


<InitializeOnePointFooter>:
    BoxLayout:
        orientation: "horizontal"
        Button:
            text: "Record datum"
            on_press: root.one_point()
        Button:
            text: "Cancel"
            on_press: app.root.current = 'MainScreen'

<EditPointsScreen>:
<EditPointScreen>:


<e5_LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            filters: ['*.cfg','*.CFG']
            path: root.start_path
        BoxLayout:
            size_hint_y: None
            spacing: 5
            padding: 5
            Button:
                text: "Cancel"
                on_release: root.cancel()
                color: root.button_color
                background_color: root.button_background
                background_normal: ''
            Button:
                text: "Open"
                on_release: root.load(filechooser.path, filechooser.selection)
                color: root.button_color
                background_color: root.button_background
                background_normal: ''

<e5_SaveDialog>:
    #text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            #on_selection: text_input.text = self.selection and self.selection[0] or ''
            path: root.start_path

        BoxLayout:
            size_hint_y: None
            spacing: 5
            padding: 5
            Button:
                text: "Cancel"
                on_release: root.cancel()
                color: root.button_color
                background_color: root.button_background
                background_normal: ''

            Button:
                text: "Save"
                on_release: root.save(filechooser.path)
                color: root.button_color
                background_color: root.button_background
                background_normal: ''

#region code from https://github.com/MichaelStott/DataframeGUIKivy/blob/master/dfguik.py

<DataGridHeaderCell>:
    size_hint: (None, None)
    text_size: self.size
    halign: "center"
    valign: "middle"
    height: '30dp'
    background_disabled_normal: '' 
    disabled_color: (1, 1, 1, 1)
    color: (1, 1, 1, 1)
    canvas.before:
        Color:
            rgba: 0.165, 0.165, 0.165, 1
        Rectangle:
            pos: self.pos
            size: self.size
    on_release: root.parent.parent.parent.parent._generate_table(self.text)

<DataGridTableHeader>:
    header: header
    bar_width: 0
    do_scroll: False
    size_hint: (1, None)
    effect_cls: "ScrollEffect"
    height: '30dp'
    GridLayout:
        id: header
        rows: 1
        size_hint: (None, None)
        width: self.minimum_width
        height: self.minimum_height

<DataGridScrollCell>:
    canvas.before:
        Color:
            rgba: root.datagrid_odd if root.is_even else root.datagrid_even
        Rectangle:
            pos: self.pos
            size: self.size
    text: root.text
    id: root.id
    on_press: root.callback(root.key, root.field, root.db)
    background_color: root.datagrid_odd if root.is_even else root.datagrid_even
    halign: "center"
    valign: "middle"
    # This setting determines if text wraps in the grid cell box
    text_size: self.size 
    size_hint: 1, 1
    #height: 60
    #width: 400

<DataGridTableData>:
    rgrid: rgrid
    scroll_type: ['bars', 'content']
    bar_color: [0.2, 0.7, 0.9, 1]
    bar_inactive_color: [0.2, 0.7, 0.9, .5]
    do_scroll_x: True
    do_scroll_y: True
    effect_cls: "ScrollEffect"
    viewclass: "DataGridScrollCell"
    RecycleGridLayout:
        id: rgrid
        rows: root.nrows
        cols: root.ncols
        size_hint: (None, None)
        width: self.minimum_width
        height: self.minimum_height

<DataGridWidget>:
    panel1: data_frame_panel
    panel2: add_new_panel
    do_default_tab: False
    TabbedPanelItem:
        text: 'Data'
        on_release: root.open_panel1()
        background_normal: ''
        DataGridGridPanel:
            id: data_frame_panel
    TabbedPanelItem:
        text: 'Edit Record'
        background_normal: ''
        on_release: root.open_panel2()
        DataGridCasePanel:
            id: add_new_panel
    TabbedPanelItem:
        text: 'Close'
        on_release: root.close_panels()
        background_normal: ''

<DataGridGridPanel>:
    orientation: 'vertical'

<DataGridCasePanel>:
    addnew_list: addnew_list
    orientation: 'vertical'
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        size_hint: 1, 1
        scroll_timeout: 150
        GridLayout:
            id: addnew_list
            padding: "10sp"
            spacing: "5sp"
            cols:1
            row_default_height: '35dp'
            row_force_default: True
            size_hint_y: None

#endregion end code from https://github.com/MichaelStott/DataframeGUIKivy/blob/master/dfguik.py
